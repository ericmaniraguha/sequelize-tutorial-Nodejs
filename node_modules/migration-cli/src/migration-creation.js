const template = `
    const runner = require('migration-cli');
    module.exports = runner(__filename, __dirname);
`;

const getActionName = (actionName) => {
    const datetime = (new Date()).toJSON().replace(/[^0-9]/g, '');
    return `${datetime}-${actionName}`;
};

const filesToCreate = (name) => {
    return {
        [`${name}.down.sql`]: '',
        [`${name}.up.sql`]: '',
        [`${name}.js`]: template,
    }   
}
const writeFiles = (writeFileSync, resolve) => (dirname, files) => Object.keys(files)
    .forEach(
        filename => (
            writeFileSync(resolve(dirname, filename), files[filename]),
            console.log('\x1b[36m', `created ${filename}`,'\x1b[0m')),
    );

module.exports = (writeFileSync, resolve) => (actionName, dirname) => {
    const name = getActionName(actionName);
    const files = filesToCreate(name);
    return writeFiles(writeFileSync, resolve)(dirname, files) 
};
