#! /usr/bin/env node
const fs = require('fs');
const path = require('path');
const cli = require('commander');
const writeMigration = require('../src/migration-creation');

const commandDir = process.cwd();
const optionsPath = path.resolve(commandDir, '.sequelizerc');
const config = fs.existsSync(optionsPath) ? require(optionsPath) : {}
cli
    .version('v0.1.0', '-v, --version')
    .description('A cli helper for migrations on rds connector');
    
cli
    .command('add <migrationName>')
    .option('-t, --type <value>', 'Migration or Seed')
    .option('-f, --folder <value>', 'Migration or Seed')
    .action((migrationName, {type, folder = '/'}) => {
        console.log('\x1b[36m', `creating ${type}: ${migrationName}`,'\x1b[0m');
        const dirname = config[`${type}s-path`] || path.resolve(commandDir, folder, `${type}s`);
        return writeMigration(fs.writeFileSync, path.resolve)(migrationName, dirname);
    });

cli.parse(process.argv);

module.exports = cli
